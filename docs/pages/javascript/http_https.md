---
sidebar: true
outline: deep
title: http与https
date: 2024-06-11
tags: js
---

# http 与 https

## 基本概念

1. **HTTP (HyperText Transfer Protocol)**: 超文本传输协议，用来在浏览器和服务器之间传输数据。传输是 明文 的。
2. **HTTPS (HTTPS (HyperText Transfer Protocol Secure))**: 安全的 HTTP，在 HTTP 的基础上加入了 SSL/TLS 协议，用于加密数据传输，确保数据传输的安全性。

## 区别

| 对比项                 | HTTP                                   | HTTPS                                          |
| ---------------------- | -------------------------------------- | ---------------------------------------------- |
| **端口**               | 默认端口 **80**                        | 默认端口 **443**                               |
| **安全性**             | 明文传输，容易被窃听、篡改、中间人攻击 | 数据加密（TLS/SSL），支持身份验证、防篡改      |
| **证书**               | 不需要证书                             | 需要申请 **SSL 证书**（免费/付费）             |
| **速度**               | 传输快，延迟低                         | 因为加解密，会稍微慢一些（现在优化后差距不大） |
| **搜索引擎优化 (SEO)** | 不安全，Google 等搜索引擎会提示不安全  | 有利于 SEO，浏览器地址栏显示小锁标识           |
| **数据完整性**         | 容易被篡改                             | 有数据校验，防止篡改                           |

## HTTP 工作原理（流程）

1. **建立连接**：基于 TCP（三次握手）建立连接， 默认端口 80。
2. **发送请求 Request**：客户端向服务器发送 HTTP 请求，包括请求方法（GET、POST 等）、请求头、请求体等。
3. **服务器处理请求**：服务器接收到请求后，找到对应的资源（如 HTML 文件，或通过后端程序生成内容，服务器准备响应报文。
4. **返回响应 Response**：服务器将响应报文发送给客户端，包括状态码、响应头、响应体等。

   - 状态码：如 200 表示请求成功，404 表示未找到资源，500 表示服务器内部错误等。
   - 响应头：说明返回内容类型、长度、缓存策略等
   - 响应体：实际返回的内容，如 HTML、JSON、图片等。

5. **关闭或复用连接**：HTTP/1.0 默认是短连接，即每次请求后都会断开连接，HTTP/1.1 默认是长连接，即多个请求可以复用同一个连接。

### 三次握手与四次挥手

三次握手 和 四次挥手，其实不是 HTTP 本身的机制，而是 TCP 协议（HTTP 是基于 TCP 之上的应用层协议）。

#### 1. TCP 三次握手（建立连接）

在通信前，保证客户端和服务器双方都确认可以发送和接收数据。

:::tip 流程

1. 第一次握手（客户端 → 服务器）
   - 客户端发送一个 SYN（同步序列号） 报文，请求建立连接。
   - 状态：客户端进入 SYN_SENT 状态。
2. 第二次握手（服务器 → 客户端）
   - 服务器收到 SYN 报文后，返回一个 SYN+ACK（同步确认） 报文，表示可以建立连接。
   - 状态：服务器进入 SYN_RCVD 状态。
3. 第三次握手（客户端 → 服务器）
   - 客户端收到 SYN+ACK 报文后，在发送一个 ACK（确认） 报文。
   - 状态：客户端进入 ESTABLISHED，服务器也进入 ESTABLISHED，连接建立完成。

:::

如下图所示：

```
客户端                         服务器
  | -------- SYN ------------> |
  | <------- SYN + ACK ------- |
  | --------- ACK -----------> |
  |         连接建立            |

```

**为什么不是两次握手？**
因为两次握手无法保证连接建立成功。如果第二次握手服务器没有收到 ACK，服务器不知道客户端是否已经准备好接收数据，所以需要第三次握手来确认。

#### 2. TCP 四次挥手（断开连接）

在通信结束时，双方都要确认「我没有数据要发了」，保证数据完整传输。
:::tip 流程

1. 第一次挥手（客户端 → 服务器）
   - 客户端发送一个 FIN（结束） 报文，表示客户端已经没有数据要发送了。
   - 状态：客户端进入 FIN_WAIT_1 状态。
2. 第二次挥手（服务器 → 客户端）
   - 服务器收到 FIN 报文后，回复 ACK 确认，表示「我知道你不发了」。
   - 状态：服务器进入 CLOSE_WAIT 状态，客户端进入 FIN_WAIT_2 状态。
3. 第三次挥手（服务器 → 客户端）
   - 服务器也没数据要发时，发送 FIN 报文。
   - 状态：服务器进入 LAST_ACK 状态。
4. 第四次挥手（客户端 → 服务器）
   - 客户端收到 FIN，回复 ACK 报文确认。
   - 状态：客户端进入 TIME_WAIT 状态，服务器进入 CLOSED 状态，连接断开。

:::

如下图所示：

```
客户端                         服务器
  | -------- FIN ------------> |
  | <------- ACK -------------- |
  | -------- FIN ------------> |
  | <------- ACK -------------- |

```

**为什么要四次？** TCP 是 全双工，发送和接收要单独关闭。客户端说「我发完了」（FIN），但服务器可能还没发完，所以需要再单独发一个 FIN。因此需要 两对 FIN-ACK（总共四次）。

#### 3.总结

三次握手：建立连接（保证双方能发能收）。  
四次挥手：断开连接（保证数据完整传输）。  
HTTP 是基于 TCP 的应用层协议，所以必须依赖这套流程来保证可靠通信。

## HTTP 的特点

1. **无状态**：每次请求都是独立的，服务器不会记住上一次请求的状态。
   - 解决方法：用 Cookie / Session / Token 来保存会话状态。
2. **明文传输**: 数据不加密，容易被窃听、篡改（所以要升级 HTTPS）。
3. **灵活**: 支持多种数据格式（HTML、JSON、图片、视频…）。

例如： 假设你输入 http://www.example.com/hello.html
浏览器 → DNS 查询 → 得到服务器 IP。→ TCP 三次握手 → 浏览器发送 HTTP 请求 → 服务器处理请求 → 返回 HTTP 响应 → TCP 四次挥手 → 浏览器解析 HTML、CSS、JS 等 → 渲染页面。

## 扩展（HTTP/1.x → HTTP/2 → HTTP/3）

**HTTP/1.0**：每次请求都要重新建立 TCP 连接。  
**HTTP/1.1**：默认长连接，多个请求可以复用同一个连接。  
**HTTP/2**：多路复用，一个连接可以同时处理多个请求。  
**HTTP/3**：基于 QUIC 协议，更快、更稳定、更安全。
